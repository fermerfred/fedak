int const MSI = 8;
long prevMomentH = 0;
long prevMomentL = 0;
boolean out;
//Выше объявление пина, лонги это переменные для сравнения времени
//прошедшего с момента выполнения программы

int PWM(long wide, long freq) //wide - длинна положительного импульса
//freq - длина всего импульса в целом, все указывать в микросекундах
{
  int raznost = freq-wide;
  int latch=1; //эта переменная сделана для того, чтобы не было зацикливания
  //  по меньшему значению сравнения времени дальше увидишь, да и в целом дальше все ясно
  unsigned long Moment = micros();
  if(Moment - prevMomentH > wide && prevMomentH != latch)
  {
    out = 0;
    prevMomentH = latch;
    prevMomentL = Moment;    
  }
  if(Moment - prevMomentL > raznost && prevMomentL != latch)
  {
    out = 1;
    prevMomentH = Moment;
    prevMomentL = latch;
  }
}


void setup() 
{
 pinMode(MSI, OUTPUT);
}

void loop() 
{
  //при значении wide 500 сервак поворачивается на 0 градусов, при 3500 на 180
  //т.е вместо одной секунды мы имеем три. Означает ли это, что значение wide
  //не соответствует реальному времени(не до микросекунд конечно, но 2 мс разницы это много)
  PWM(3500, 20000);
  digitalWrite(MSI, out);
}